var documenterSearchIndex = {"docs":
[{"location":"Examples/receiver/#Receiver","page":"Receiver","title":"Receiver","text":"","category":"section"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"This example configures the BladeRF as a receiver and captures samples on channel 0. There is a lot of setup, as this is a low-level API.","category":"page"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"using ..BladeRF\nusing DSP\nusing Plots\nENV[\"GKSwstype\"]=\"100\" # run Plots headless\n\n# Initialize the device\nradioBoard = BladeRF.BladeRFDevice();\n\n\ndesired_freq_Hz = round(Int64, 2.4e9);\nBladeRF.set_frequency(radioBoard, 0, desired_freq_Hz);\n\n# Get frequency to verify\nfreq = BladeRF.get_frequency(radioBoard, 0);\n\n# Setting bandwidth\ndesired_bandwidth = 5000000  # Desired bandwidth in Hz\nactual_bandwidth = BladeRF.set_bandwidth(radioBoard, 0, desired_bandwidth)\n\n# Enable module\nBladeRF.enable_module(radioBoard, 0, true)\n\n# Set sample rate\nactual_rate_Hz = BladeRF.set_sample_rate(radioBoard, 0, 1000000)\n\n# Set gain mode\nBladeRF.set_gain_mode(radioBoard, 0, BladeRF.BLADERF_GAIN_MGC)\n\n# Set gain\nBladeRF.set_gain(radioBoard, 0, 30)","category":"page"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"We have configured the receiver, and it's time to set up the sampling.","category":"page"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"sample_format = BladeRF.BLADERF_FORMAT_SC16_Q11\n\nnum_samples = 4096\n\nbytes_per_sample = 4\nbuffer_size_samples = 1024\nbuffer_size = ceil(Int, buffer_size_samples * bytes_per_sample)\nread_cycles = ceil(Int, num_samples / (buffer_size / bytes_per_sample))\ntotal_bytes = Int(read_cycles * buffer_size)\n\nreceived_bytes = Vector{UInt8}(undef, total_bytes)\nbuf = Vector{UInt8}(undef, buffer_size)\nmetadata = BladeRF.init_metadata()\ntimeout_ms = UInt(1000)  # Timeout in milliseconds\n\nchannel = BladeRF.BladerfChannelLayout(0)\n\nnum_buffers = UInt(32)\nblade_buffer_size = UInt(8192)\nnum_transfers = UInt(16)\nstream_timeout = UInt(1000)\n\nBladeRF.sync_config(radioBoard, channel, sample_format, num_buffers, blade_buffer_size, num_transfers, stream_timeout)\n\n\nBladeRF.enable_module(radioBoard, 0, true)\n\nGC.@preserve buf metadata begin\n    buffer_ptr = Base.unsafe_convert(Ptr{Nothing}, pointer(buf))\n    metadata_ref = Ref(metadata)\n    metadata_ptr = Base.unsafe_convert(Ptr{BladeRF.BladerfMetadata}, metadata_ref)\n\n    # Receive samples\n    index = 1\n    for i in 1:read_cycles\n        BladeRF.sync_rx(radioBoard, buffer_ptr, UInt(buffer_size_samples), metadata_ptr, timeout_ms)\n        unsafe_copyto!(received_bytes, index, buf, 1, buffer_size)\n        global index += buffer_size\n    end\nend\n\nBladeRF.enable_module(radioBoard, 0, false)\n\n# Close the device\nBladeRF.close(radioBoard)\n\n\ncomplex_samples = reinterpret(Complex{Int16}, received_bytes)\nnormalized_samples = Complex{Float32}.(complex_samples) ./ 2048.0;\nprintln(\"length(normalized_samples) = \", length(normalized_samples))","category":"page"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"We have now successfully sampled with the radio. To verify the samples, let's plot its Power Spectral Density (PSD).","category":"page"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"pgram = periodogram(normalized_samples, onesided=false, fs=actual_rate_Hz)\n\nplot(pgram.freq, pow2db.(pgram.power), title=\"Power Spectral Density\", xlabel=\"Frequency\", ylabel=\"Power [dB/Hz]\")\n\nsavefig(\"src/plots/Receiver_PSD.svg\"); nothing","category":"page"},{"location":"Examples/receiver/","page":"Receiver","title":"Receiver","text":"(Image: PSD of the samples)","category":"page"},{"location":"#BladeRF.jl-Documentation","page":"BladeRF.jl Documentation","title":"BladeRF.jl Documentation","text":"","category":"section"},{"location":"","page":"BladeRF.jl Documentation","title":"BladeRF.jl Documentation","text":"Modules = [BladeRF]\nPrivate = true\nOrder = [:function]","category":"page"},{"location":"","page":"BladeRF.jl Documentation","title":"BladeRF.jl Documentation","text":"Modules = [BladeRF]\nPrivate = true\nOrder = [:type]","category":"page"}]
}
